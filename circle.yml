dependencies:
  cache_directories:
    - "~/virtualenvs/venv-system/lib/python2.7/site-packages/examples/"

  pre:
    - wget -q http://repo.continuum.io/miniconda/Miniconda-latest-Linux-x86_64.sh -O miniconda.sh
    - chmod +x miniconda.sh
    - ./miniconda.sh -b -p /home/ubuntu/miniconda
    - /home/ubuntu/miniconda/bin/conda update --yes --quiet conda
    - /sbin/start-stop-daemon --start --quiet --pidfile /tmp/custom_xvfb_99.pid --make-pidfile --background --exec /usr/bin/Xvfb -- :99 -screen 0 1400x900x24 -ac
    - pip install sphinx 
    - pip install sphinx_gallery
    - pip install sphinx_bootstrap_theme
    - pip install pygraphviz
    - pip install matplotlib
    - pip install Pillow
    - sudo apt-get install libvtk5-dev python-vtk python-configobj
    - /home/ubuntu/miniconda/bin/conda install --yes --quiet $ENSURE_PACKAGES mayavi

test:
  override:
    - cd .. && mkdir .mne && cd .mne && echo '{"MNE_DATASETS_BRAINSTORM_PATH":"~/virtualenvs/venv-system/lib/python2.7/site-packages/examples/","MNE_DATASETS_EEGBCI_PATH":"~/virtualenvs/venv-system/lib/python2.7/site-packages/examples/","MNE_DATASETS_MEGSIM_PATH":"~/virtualenvs/venv-system/lib/python2.7/site-packages/examples/","MNE_DATASETS_SAMPLE_PATH":"~/virtualenvs/venv-system/lib/python2.7/site-packages/examples/","MNE_DATASETS_SOMATO_PATH":"~/virtualenvs/venv-system/lib/python2.7/site-packages/examples/","MNE_DATASETS_SPM_FACE_PATH":"~/virtualenvs/venv-system/lib/python2.7/site-packages/examples/","MNE_DATASETS_TESTING_PATH":"~/virtualenvs/venv-system/lib/python2.7/site-packages/examples/"}' > mne-python.json
    - cd ../virtualenvs/venv-system/lib/python2.7/site-packages && mkdir examples
    - cd ../virtualenvs/venv-system/lib/python2.7/site-packages/examples && mkdir MNE-brainstorm-data && cd MNE-brainstorm-data && wget https://copy.com/ZTHXXFcuIZycvRoA/brainstorm/bst_raw.tar.bz2 && tar xvf bst_raw.tar.bz2
    - cd ../virtualenvs/venv-system/lib/python2.7/site-packages/examples && mkdir MEGSIM && cd MEGSIM && mkdir megsim && cd megsim && mkdir empdata && cd empdata && mkdir neuromag && cd neuromag && mkdir visual && cd visual && wget http://cobre.mrn.org/megsim/empdata/neuromag/visual/subject1_day1_vis_raw.fif && wget http://cobre.mrn.org/megsim/empdata/neuromag/visual/subject1_day2_vis_raw.fif && wget http://cobre.mrn.org/megsim/empdata/neuromag/visual/subject3_day1_vis_raw.fif && wget http://cobre.mrn.org/megsim/empdata/neuromag/visual/subject3_day2_vis_raw.fif 
    - cd ../virtualenvs/venv-system/lib/python2.7/site-packages/examples/MEGSIM/megsim && mkdir simdata && cd simdata && mkdir neuromag && cd neuromag && mkdir visual && cd visual && wget http://cobre.mrn.org/megsim/simdata/neuromag/visual/M87174545_vis_sim1A_4mm_30na_neuro_rn.fif && wget http://cobre.mrn.org/megsim/simdata/neuromag/visual/M87174545_vis_sim1B_20mm_50na_neuro_rn.fif && wget http://cobre.mrn.org/megsim/simdata/neuromag/visual/M87174545_vis_sim2_4mm_30na_neuro_rn.fif && wget http://cobre.mrn.org/megsim/simdata/neuromag/visual/M87174545_vis_sim3A_4mm_30na_neuro_rn.fif && wget http://cobre.mrn.org/megsim/simdata/neuromag/visual/M87174545_vis_sim3B_20mm_50na_neuro_rn.fif && wget http://cobre.mrn.org/megsim/simdata/neuromag/visual/M87174545_vis_sim4_4mm_30na_neuro_rn.fif && wget http://cobre.mrn.org/megsim/simdata/neuromag/visual/M87174545_vis_sim5_4mm_30na_neuro_rn.fif
    - cd doc && make html_dev
    - cd doc && make html_stable

general:
  artifacts:
    - "doc/_build/html"
    - "doc/build/html_stable"

