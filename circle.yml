dependencies:
  cache_directories:
    - ../examples/

  pre:
    #- wget -q http://repo.continuum.io/miniconda/Miniconda-latest-Linux-x86_64.sh -O miniconda.sh
    #- chmod +x miniconda.sh
    #- ./miniconda.sh -b -p /home/ubuntu/miniconda
    #- export PATH=/home/ubuntu/miniconda/bin:$PATH && pip install numpy sphinx==1.2.3 sphinx_gallery sphinx_bootstrap_theme pygraphviz matplotlib Pillow neo
    #- /home/ubuntu/miniconda/bin/conda update --yes --quiet conda
    - sudo pip install --upgrade pip
    - sudo pip install ipython
    - sudo pip install sphinx==1.2.3 pygraphviz matplotlib Pillow neo scipy numpy
    #- sudo pip install sphinx_gallery sphinx_bootstrap_theme
    - cd .. && git clone https://github.com/sphinx-gallery/sphinx-gallery.git && cd sphinx-gallery && sudo pip install -r requirements.txt && sudo python setup.py develop
    - sudo pip install sphinx_bootstrap_theme
    - sudo pip install numpy --upgrade
    - sudo apt-get install libvtk5-dev python-vtk python-configobj
    - sudo pip install mayavi
    - sudo pip install pysurfer
    - /sbin/start-stop-daemon --start --quiet --pidfile /tmp/custom_xvfb_99.pid --make-pidfile --background --exec /usr/bin/Xvfb -- :99 -screen 0 1400x900x24 -ac +extension GLX +render -noreset
    #- export PATH=/home/ubuntu/miniconda/bin:$PATH && sudo pip install ipython
    #- export PATH=/home/ubuntu/miniconda/bin:$PATH && sudo pip install pysurfer scikit-learn
    #- export PATH=/home/ubuntu/miniconda/bin:$PATH && sudo apt-get install python python-tk idle python-pmw python-imaging
    - sudo pip install scikit-learn
    - sudo python setup.py install
    - sudo make sample_data
    - sudo make testing_data
    - sudo make spm_data
    - sudo make somato_data
    # Add a conf file manually to avoid queries in the middle of the build.
    - cd .. && cd .mne && sudo chmod 777 mne-python.json && echo '{"MNE_DATASETS_BRAINSTORM_PATH":"/home/ubuntu/examples","MNE_DATASETS_EEGBCI_PATH":"/home/ubuntu/examples","MNE_DATASETS_MEGSIM_PATH":"/home/ubuntu/examples","MNE_DATASETS_SAMPLE_PATH":"/home/ubuntu/examples","MNE_DATASETS_SOMATO_PATH":"/home/ubuntu/examples","MNE_DATASETS_SPM_FACE_PATH":"/home/ubuntu/examples","MNE_DATASETS_TESTING_PATH":"/home/ubuntu/examples"}' > mne-python.json
    - if [[ ! -e ../examples/MNE-brainstorm-data ]]; then cd .. && sudo chmod 777 examples && cd examples && mkdir MNE-brainstorm-data && cd MNE-brainstorm-data && wget https://copy.com/ZTHXXFcuIZycvRoA/brainstorm/bst_raw.tar.bz2 && tar xvf bst_raw.tar.bz2; fi

  override:
    - cd .. && sudo chmod 777 .mne
    - cd .. && sudo chmod 777 examples

test:
  override:
    # Some examples take longer than 10 minutes to run.
    - case $CIRCLE_NODE_INDEX in 0) cd doc && make html_dev-pattern PATTERN='/io\|/inverse\|/decoding' ;; 1) cd doc && make html_dev-pattern PATTERN='/preprocessing\|/visualization\|/datasets' ;; 2) cd doc && make html_dev-pattern PATTERN='/time_frequency\|/stats\|/simulation' ;; 3)cd doc && make html_dev-pattern PATTERN='/connectivity\|/realtime\|/forward' ;; esac:
        parallel: true
        timeout: 1500

general:
  artifacts:
    - "doc/_build/html"
    - "doc/build/html_stable"

