dependencies:
  cache_directories:
    - "/home/ubuntu/mne_data/"

  pre:
    - wget -q http://repo.continuum.io/miniconda/Miniconda-latest-Linux-x86_64.sh -O miniconda.sh
    - chmod +x miniconda.sh
    - ./miniconda.sh -b -p /home/ubuntu/miniconda
    - export PATH=/home/ubuntu/miniconda/bin:$PATH && pip install numpy sphinx sphinx_gallery sphinx_bootstrap_theme pygraphviz matplotlib Pillow
    - /home/ubuntu/miniconda/bin/conda update --yes --quiet conda
    - /sbin/start-stop-daemon --start --quiet --pidfile /tmp/custom_xvfb_99.pid --make-pidfile --background --exec /usr/bin/Xvfb -- :99 -screen 0 1400x900x24 -ac
    - sudo apt-get install libvtk5-dev python-vtk python-configobj
    - export PATH=/home/ubuntu/miniconda/bin:$PATH && conda install --yes --quiet $ENSURE_PACKAGES mayavi
    - /home/ubuntu/miniconda/bin/conda install --yes --quiet $ENSURE_PACKAGES scipy
    - export PATH=/home/ubuntu/miniconda/bin:$PATH && pip install ipython
    - export PATH=/home/ubuntu/miniconda/bin:$PATH && pip install pysurfer scikit-learn
    - /home/ubuntu/miniconda/bin/python setup.py install
    - make sample_data

test:
  override:
    # Add a conf file manually to avoid queries in the middle of the build.
    - cd .. && mkdir .mne && cd .mne && echo '{"MNE_DATASETS_BRAINSTORM_PATH":"/home/ubuntu/mne_data","MNE_DATASETS_EEGBCI_PATH":"/home/ubuntu/mne_data","MNE_DATASETS_MEGSIM_PATH":"/home/ubuntu/mne_data","MNE_DATASETS_SAMPLE_PATH":"/home/ubuntu/mne_data","MNE_DATASETS_SOMATO_PATH":"/home/ubuntu/mne_data","MNE_DATASETS_SPM_FACE_PATH":"/home/ubuntu/mne_data","MNE_DATASETS_TESTING_PATH":"/home/ubuntu/mne_data"}' > mne-python.json
    - cd .. && mkdir mne_data && cd mne_data && mkdir MNE-brainstorm-data && cd MNE-brainstorm-data && wget https://copy.com/ZTHXXFcuIZycvRoA/brainstorm/bst_raw.tar.bz2 && tar xvf bst_raw.tar.bz2
    # Some examples take longer than 10 minutes to run.
    - export PATH=/home/ubuntu/miniconda/bin:$PATH && cd doc && make html_dev:
        timeout: 1500
    #- export PATH=/home/ubuntu/miniconda/bin:$PATH && cd doc && make html_stable:
    #    timeout: 1500

general:
  artifacts:
    - "doc/_build/html"
    - "doc/build/html_stable"

